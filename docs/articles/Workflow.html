<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
<code>mixchar</code> workflow • mixchar</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="&lt;code&gt;mixchar&lt;/code&gt; workflow">
<meta property="og:description" content="">
<meta property="og:image" content="http://smwindecker.github.io/mixchar/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mixchar</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mixchar.html">Introduction to mixchar</a>
    </li>
    <li>
      <a href="../articles/Workflow.html">Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/smwindecker/mixchar">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>
<code>mixchar</code> workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smwindecker/mixchar/blob/master/vignettes/Workflow.Rmd"><code>vignettes/Workflow.Rmd</code></a></small>
      <div class="hidden name"><code>Workflow.Rmd</code></div>

    </div>

    
    
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>1. Load data</h2>
<p>We have included two example datasets in this package, called <code>juncus</code> and <code>marsilea</code>, that we will use for this demonstration. The <code>juncus</code> dataset contains mass loss and temperature data derived from the theromogravimetric analysis of a sample of the freshwater reed, <em>Juncus amabilis</em>, and <code>marsilea</code> contains data for the freshwater fern, <em>Marsilea drumondii</em>.</p>
<p>The first step for you will be to load your mass loss by temperature data. This package was developed using TGA data produced by a Netzsch TGA-FTIR thermogravimetric analyser, which outputs a table with temperature and mass loss for each point of measurement. If your TGA machine outputs data in another format, you’ll need to reformat like the example below, or <a href="http://www.github.com/smwindecker/mixchar">get in touch with us</a>, and we’ll add new functionality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mixchar)
<span class="kw">head</span>(juncus)</code></pre></div>
<pre><code>##   temp_C mass_loss
## 1 31.453 -0.000931
## 2 31.452 -0.001340
## 3 31.450 -0.001350
## 4 31.450 -0.001660
## 5 31.450 -0.001680
## 6 31.450 -0.001800</code></pre>
<hr>
</div>
<div id="process-data" class="section level2">
<h2 class="hasAnchor">
<a href="#process-data" class="anchor"></a>2. <code>process</code> data</h2>
<p>After we’ve loaded our data, we need to calculate the derivative of the mass loss, or in other words the rate of mass loss across temperature. This will produce the multi-peaked rate of decay curve that we will apply the mixture model to. The <code>process</code> function takes the derivative of our mass loss data, taking as arguments the dataset, the column names for the temperature and mass loss data, respectively, and a value for the starting mass of the sample. The function defaults to temperature data in Celsius, but you can also modify to indicate the data is provided in Kelvin, by specifying the argument <code>temp_type = 'K'</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">deriv_juncus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(juncus, 
                        <span class="dt">temp =</span> <span class="st">'temp_C'</span>, 
                        <span class="dt">mass =</span> <span class="st">'mass_loss'</span>, 
                        <span class="dt">init_mass =</span> <span class="fl">18.96</span>)
deriv_juncus</code></pre></div>
<pre><code>## Derivative thermogravimetry data (DTG) calculated for
##  768 datapoints from 31.5 to 798.52 degrees C.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">deriv_marsilea &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(marsilea, 
                          <span class="dt">temp =</span> <span class="st">'temp_C'</span>, 
                          <span class="dt">mass =</span> <span class="st">'mass_loss'</span>, 
                          <span class="dt">init_mass =</span> <span class="fl">15.29</span>)
deriv_marsilea</code></pre></div>
<pre><code>## Derivative thermogravimetry data (DTG) calculated for
##  768 datapoints from 31.5 to 798.51 degrees C.</code></pre>
<hr>
</div>
<div id="plot-mass-loss-and-rate-of-mass-loss-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-mass-loss-and-rate-of-mass-loss-curves" class="anchor"></a>3. Plot mass loss and rate of mass loss curves</h2>
<p>At this point we can take a look at what we’ve done so far using the default plotting option for your processed data. If you <code>plot()</code> the output of the <code>process</code> function, you will get two curves: the mass of sample across time and the rate of mass loss curve. If you’re only interested in one plot, you can specify <code>plot_type = 'mass'</code> or <code>plot_type = 'rate'</code>.</p>
<p>The rate of mass loss curve helps us to visualise the three stages of mass loss: * Phase 1: A short period with of dehydration, up until approximately 120 <span class="math inline">\(^{\circ}\)</span>C. * Phase 2: A wide mid-range of high mass loss, caused by devolatilisation of primary biomass carbon components, between approximately 120650 <span class="math inline">\(^{\circ}\)</span>C. * Phase 3: A final period of little mass loss when carbonaceous material associated with the inorganic fraction decomposes, after approximately 650 <span class="math inline">\(^{\circ}\)</span>C. In the next step we will crop the data to include only phase 2, so visualising your own data is important to check that the default temperature bounds will be suitable, in case for example the dehydration phase extends past 120 C or ends earlier. Comparing the plots for the two species we can see similarities in the shape and location of the peaks of the overall rate of mass loss curve, but also subtle differences. It is these characteristics we will tease apart using the nonlinear mixture model in the next step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(deriv_juncus)</code></pre></div>
<p><img src="Workflow_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(deriv_marsilea)</code></pre></div>
<p><img src="Workflow_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<hr>
</div>
<div id="deconvolve-data" class="section level2">
<h2 class="hasAnchor">
<a href="#deconvolve-data" class="anchor"></a>4. <code>deconvolve</code> data</h2>
<p>The <code>decovolve</code> function takes care of modelling the rate of mass loss data with the nonlinear mixture model. To do so it first crops to the second phase, as mentioned above, to default temperature bounds of 120 C and 700 C. These can be modified with the <code>lower_temp</code> and <code>upper_temp</code> arguments. Although most biomass samples have only three main components (corresponding to hemicellulose, cellulose, and lignin), some have a second hemicellulose curve in the low temperature range. <code>deconvolve</code> will decide whether three or four curves are best using an internal function that determines if there is a peak below 220 C. Upon inspection of your curve you can override this by modifying the <code>n_curves</code> argument. The function also has built in starting values for the nonlinear optimisation. These values were tested on litter from 30 plant species, encompassing herbaceous, graminoid, as well as woody species. However, if they do not work for your sample, or would like to play with the effect of changing them, you can do so with the <code>start_vec</code>, <code>lower_vec</code>, and <code>upper_vec</code> arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output_juncus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deconvolve.html">deconvolve</a></span>(deriv_juncus)
output_juncus</code></pre></div>
<pre><code>## Deconvolution by 3-part Fraser-Suzuki mixture model fitted to 
## 580 datapoints from 120 to 700 degrees C.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output_marsilea &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deconvolve.html">deconvolve</a></span>(deriv_marsilea)
output_marsilea</code></pre></div>
<pre><code>## Deconvolution by 4-part Fraser-Suzuki mixture model fitted to 
## 580 datapoints from 120 to 700 degrees C.</code></pre>
<hr>
</div>
<div id="examine-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#examine-outputs" class="anchor"></a>5. Examine outputs</h2>
<p><code>deconvolve</code> results in a few different outputs that you can retrieve with accessor functions.</p>
<div id="rate_data" class="section level3">
<h3 class="hasAnchor">
<a href="#rate_data" class="anchor"></a><code><a href="../reference/rate_data.html">rate_data()</a></code>
</h3>
<ul>
<li>will show you the processed dataset that results from the <code>process</code> function, useful if you want to play around with other modelling approaches or plotting options:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">juncus_rate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rate_data.html">rate_data</a></span>(output_juncus)
<span class="kw">head</span>(juncus_rate)</code></pre></div>
<pre><code>##       temp_C        deriv   mass_T
## 5325 120.514 9.570652e-05 17.91630
## 5384 121.501 9.885901e-05 17.91445
## 5445 122.515 1.003878e-04 17.91252
## 5505 123.514 9.133606e-05 17.91079
## 5565 124.513 6.493836e-05 17.90956
## 5625 125.509 8.578618e-05 17.90794</code></pre>
</div>
<div id="temp_bounds" class="section level3">
<h3 class="hasAnchor">
<a href="#temp_bounds" class="anchor"></a><code><a href="../reference/temp_bounds.html">temp_bounds()</a></code>
</h3>
<ul>
<li>will print the temperature values at which the data were cropped for analysis:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/temp_bounds.html">temp_bounds</a></span>(output_juncus)</code></pre></div>
<pre><code>## [1] 120 700</code></pre>
</div>
<div id="model_fit" class="section level3">
<h3 class="hasAnchor">
<a href="#model_fit" class="anchor"></a><code><a href="../reference/model_fit.html">model_fit()</a></code>
</h3>
<ul>
<li>will show you the output of the mixture model:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/model_fit.html">model_fit</a></span>(output_juncus)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: deriv ~ fs_mixture(temp_C, height_1, skew_1, position_1, width_1,     height_2, skew_2, position_2, width_2, height_3, skew_3,     position_3, width_3)
##    data: dataframe
##   height_1     skew_1 position_1    width_1   height_2     skew_2 
##  3.944e-03  1.258e-01  2.662e+02  5.106e+01  5.793e-03  1.344e-02 
## position_2    width_2   height_3     skew_3 position_3    width_3 
##  3.173e+02  2.866e+01  1.163e-03  1.085e-01  3.300e+02  2.500e+02 
##  residual sum-of-squares: 9.299e-06
## 
## Number of iterations to convergence: 23 
## Achieved convergence tolerance: 1.49e-08</code></pre>
<ul>
<li>the model fit will show us the estimated parameter values height, skew, position, and width for each curve. Curve 1 is hemicellulose, curve 2 is cellulose, and curve 3 is lignin.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/model_fit.html">model_fit</a></span>(output_marsilea)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: deriv ~ fs_mixture(temp_C, height_1, skew_1, position_1, width_1,     height_2, skew_2, position_2, width_2, height_3, skew_3,     position_3, width_3, height_0, skew_0, position_0, width_0)
##    data: dataframe
##   height_0     skew_0 position_0    width_0   height_1     skew_1 
##  8.208e-04 -2.169e-01  1.879e+02  5.372e+01  2.618e-03 -3.300e-01 
## position_1    width_1   height_2     skew_2 position_2    width_2 
##  2.763e+02  5.240e+01  3.768e-03 -9.295e-02  3.165e+02  3.118e+01 
##   height_3     skew_3 position_3    width_3 
##  1.163e-03  2.000e-01  3.300e+02  2.500e+02 
##  residual sum-of-squares: 6.385e-06
## 
## Number of iterations to convergence: 25 
## Achieved convergence tolerance: 1.49e-08</code></pre>
<ul>
<li>if present, the optional fourth curve located at the lowest temperature interval will be listed as curve 0.</li>
</ul>
</div>
<div id="component_weights" class="section level3">
<h3 class="hasAnchor">
<a href="#component_weights" class="anchor"></a><code><a href="../reference/component_weights.html">component_weights()</a></code>
</h3>
<ul>
<li>will display the mean, upper, and lower confidence intervals for each estimated component:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/component_weights.html">component_weights</a></span>(output_juncus)</code></pre></div>
<pre><code>##   HC CL LG value_type
## 1  0  0  0       2.5%
## 2  0  0  0      97.5%
## 3  0  0  0       mean</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/component_weights.html">component_weights</a></span>(output_marsilea)</code></pre></div>
<pre><code>##   HC_1 HC_2 CL LG value_type
## 1    0    0  0  0       2.5%
## 2    0    0  0  0      97.5%
## 3    0    0  0  0       mean</code></pre>
<hr>
</div>
</div>
<div id="plot-deconvolved-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-deconvolved-curves" class="anchor"></a>6. Plot deconvolved curves</h2>
<p>The default plotting function for the output of the <code>deconvolve</code> function shows you your raw mass data, the estimated full curve from the mixture model, and also plots the individual component curves using their parameter estimates from the model.</p>
<p>Take a look at your plot. Do the estimates seem reasonable?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(output_juncus)</code></pre></div>
<p><img src="Workflow_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(output_marsilea)</code></pre></div>
<p><img src="Workflow_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>If you want to modify the aesthetics of this plot for your own work, then you can access the parameter estimates as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit_juncus &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_fit.html">model_fit</a></span>(output_juncus)
params &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">summary</span>(fit_juncus)<span class="op">$</span>coefficients[,<span class="dv">1</span>])</code></pre></div>
<p>and use the <code>fs_function</code> to plot individual component curves, and <code>fs_mixture</code> function to plot the overall mixture curve.</p>
<hr>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-data">1. Load data</a></li>
      <li><a href="#process-data">2. <code>process</code> data</a></li>
      <li><a href="#plot-mass-loss-and-rate-of-mass-loss-curves">3. Plot mass loss and rate of mass loss curves</a></li>
      <li><a href="#deconvolve-data">4. <code>deconvolve</code> data</a></li>
      <li><a href="#examine-outputs">5. Examine outputs</a></li>
      <li><a href="#plot-deconvolved-curves">6. Plot deconvolved curves</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/smwindecker">Saras Windecker</a>, <a href="https://github.com/goldingn">Nick Golding</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
