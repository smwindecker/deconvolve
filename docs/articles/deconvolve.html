<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using deconvolve for lignocellulosic biomass estimates • deconvolve</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using deconvolve for lignocellulosic biomass estimates">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">deconvolve</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/deconvolve.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smwindecker/deconvolve">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using deconvolve for lignocellulosic biomass estimates</h1>
                        <h4 class="author">Saras M. Windecker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/smwindecker/deconvolve/blob/master/vignettes/deconvolve.Rmd"><code>vignettes/deconvolve.Rmd</code></a></small>
      <div class="hidden name"><code>deconvolve.Rmd</code></div>

    </div>

    
    
<div id="section-why-deconvolution" class="section level2">
<h2 class="hasAnchor">
<a href="#section-why-deconvolution" class="anchor"></a>Why deconvolution?</h2>
<p>Ecologists are often interested in determining the composition of plant cell wall biomass, primarily hemicellulose, cellulose, and lignin carbon types (collectively termed lignocellulosic biomass). Proportions of these carbon types are useful for estimating kinetic decay parameters or for calculation of intrinsic plant traits. Traditional methods for calculation of lignocellulosic biomass involve wet chemistry methods that can be monetarily and environmentally costly. Thermogravimetric analysis (TGA) is an alternative method, already used in the biofuel field, to approximate these carbon compounds from mass loss data obtained by heating a biomass sample (in a <span class="math inline">\(N_2\)</span> environment, termed pyrolysis).</p>
<p>To estimate carbon components from this mass loss data we have to take the derivative, to find the rate of mass loss across temperature, and then use a mixture model to separate the multi-peaked derivative curve into constituent parts. This process is called deconvolution, and is typically conducted in proprietary peak-fitting softwares, which, while effective, are not open source. This package seeks to provide a platform for reproducible deconvolution using R. This methodology has been tested on a range of plant litter composed primarily of soluble carbohydrates, hemicellulose, cellulose, and lignin. For more details (link paper here).</p>
<hr>
</div>
<div id="section-mixture-model" class="section level2">
<h2 class="hasAnchor">
<a href="#section-mixture-model" class="anchor"></a>Mixture model</h2>
<p>The meat of this package is in the mixture model used to deconvolve the derivative rate curve. Many different mathematical models have been proposed to fit the form of the independent curves, including Gassian, Lorentzian, Weibull, the asymmetric bi-Gaussian, and the Frazer-Suzuki distributions. Symmetric curves such as the Gaussian and Lorentzian curves struggle to model these kinetic curves because they are often asymmetric. The four-parameter Fraser-Suzuki function is highly flexible and therefore performs well.</p>
<span class="math display">\[\begin{equation}
\frac{d\alpha_i}{dT} = h_i\ exp\bigg\{-\frac{ln2}{s_i^2}\Big[ln\Big(1 + 2s_i \frac{T - p_i}{w_i}\Big)\Big]^2\bigg\}
\end{equation}\]</span>
<p>Because we can assume that the carbon components decay relatively independently, we can thus model the full multi-peaked derivative rate of mass loss curve as the sum of independent Fraser-Suzuki curves. You can play around with changing individual parameters for each curve, and check out the effect on the overall decay curve, using the widget below:</p>
<iframe data-deferred-src="app7ffe50eee827546ea94745cbe382508b/?w=&amp;__subapp__=1" width="100%" height="400" class="shiny-frame shiny-frame-deferred"></iframe>
<hr>
</div>
<div id="section-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#section-workflow" class="anchor"></a>Workflow</h2>
<div id="section-load-data" class="section level3">
<h3 class="hasAnchor">
<a href="#section-load-data" class="anchor"></a>1. Load data</h3>
<p>To use the deconvolve package, first you’ll need to load your mass loss by temperature data. This package was developed using TGA data produced by a Netzsch TGA-FTIR thermogravimetric analyser, which output the data as a table with temperature and mass loss. If your TGA machine outputs data in another format, you’ll need to reformat like the example below, or get in touch with us, and we’ll add new functionality to accommodate your data formats.</p>
<p>We have included an example dataset in this package, called <code>juncus</code>, that we will use for this demonstration and that you can have a look at to check if your data is in the right format. The <code>juncus</code> dataset contains mass loss and temperature data derived from the theromogravimetric analysis of a sample of the freshwater reed, <em>Juncus amabilis</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(deconvolve)
<span class="kw">data</span>(juncus)
<span class="kw">head</span>(juncus)</code></pre></div>
<pre><code>##   temp_C mass_loss
## 1 31.453 -0.000931
## 2 31.452 -0.001340
## 3 31.450 -0.001350
## 4 31.450 -0.001660
## 5 31.450 -0.001680
## 6 31.450 -0.001800</code></pre>
</div>
<div id="section-process-data" class="section level3">
<h3 class="hasAnchor">
<a href="#section-process-data" class="anchor"></a>2. <code>process</code> data</h3>
<p>The <code>process</code> function takes the derivative of our mass loss data, resulting in rate of mass loss over temperature data. To use this function you simply need to specify the dataset, identify which columns contain temperature and mass loss data, and provide a value for the starting mass of the sample. The function defaults to temperature data in Celsius, but you can also modify to indicate the data is provided in Kelvin, by specifying the argument <code>temp_type = 'K</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/process.html">process</a></span>(juncus, 
               <span class="dt">temp_col =</span> <span class="st">'temp_C'</span>, 
               <span class="dt">massloss_col =</span> <span class="st">'mass_loss'</span>, 
               <span class="dt">init_mass =</span> <span class="fl">18.96</span>)
tmp</code></pre></div>
<pre><code>## Derivative thermogravimetry data (DTG) calculated for 768 datapoints from 31.5 to 798.52 degrees C.</code></pre>
</div>
<div id="section-plot-mass-loss-and-dtg-curve" class="section level3">
<h3 class="hasAnchor">
<a href="#section-plot-mass-loss-and-dtg-curve" class="anchor"></a>3. Plot mass loss and DTG curve</h3>
<p>The default plotting option for your processed data is the DTG curve, but you can check out the original mass loss curve on its own or together with the DTG curve by specifying the <code>plot_type</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(tmp, <span class="dt">plot_type =</span> <span class="st">'both'</span>)</code></pre></div>
<p><img src="deconvolve_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="section-deconvolve-data" class="section level3">
<h3 class="hasAnchor">
<a href="#section-deconvolve-data" class="anchor"></a>4. <code>deconvolve</code> data</h3>
<p>Processed data then simply needs to be deconvolved into its constituent parts. The deconvolve function takes care of this step, by cropping the derivative data to exclude the early mass loss from dehydration and then running the Fraser-Suzuki mixture model. Although most biomass samples have only three main components (corresponding to hemicellulose, cellulose, and lignin), some have a second hemicellulose curve in the low temperature range. The second example dataset <code>marsilea</code> is an example of this. The deconvolve function will decide whether three or four curves are best, but you can override it by modifying the <code>n_curves</code> argument. The function also has built in starting values for the nonlinear optimisation. If you’d like to modify those, or the upper and lower bounds for the parameter estimates, you can also do so with the <code>start_vec</code>, <code>lower_vec</code>, and <code>upper_vec</code> arguments to <code><a href="../reference/deconvolve.html">deconvolve()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/deconvolve.html">deconvolve</a></span>(tmp)
output</code></pre></div>
<pre><code>## Deconvolution by 3-part Fraser-Suzuki mixture model fitted to 580 datapoints from 120 to 700 degrees C.</code></pre>
</div>
<div id="section-examine-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#section-examine-outputs" class="anchor"></a>5. Examine outputs</h3>
<p>The <code><a href="../reference/deconvolve.html">deconvolve()</a></code> function results in a few different outputs. You can look at each output individually using accessor functions.</p>
<div id="section-modified-dataframe-output" class="section level4">
<h4 class="hasAnchor">
<a href="#section-modified-dataframe-output" class="anchor"></a>modified dataframe output</h4>
<p><code><a href="../reference/ModData.html">ModData()</a></code> will show you the modified dataset used for fitting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw"><a href="../reference/ModData.html">ModData</a></span>(output))</code></pre></div>
<pre><code>##       temp_C        deriv   mass_T
## 5325 120.514 9.570652e-05 17.91630
## 5384 121.501 9.885901e-05 17.91445
## 5445 122.515 1.003878e-04 17.91252
## 5505 123.514 9.133606e-05 17.91079
## 5565 124.513 6.493836e-05 17.90956
## 5625 125.509 8.578618e-05 17.90794</code></pre>
</div>
<div id="section-bounds-output" class="section level4">
<h4 class="hasAnchor">
<a href="#section-bounds-output" class="anchor"></a>bounds output</h4>
<p><code><a href="../reference/Bounds.html">Bounds()</a></code> will print the temperature values at which the data were cropped for analysis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Bounds.html">Bounds</a></span>(output)</code></pre></div>
<pre><code>## [1] 120 700</code></pre>
</div>
<div id="section-minpack-lm-model-output" class="section level4">
<h4 class="hasAnchor">
<a href="#section-minpack-lm-model-output" class="anchor"></a>minpack.lm model output</h4>
<p><code><a href="../reference/Model.html">Model()</a></code> will show you the output of the Fraser-Suzuki mixture model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Model.html">Model</a></span>(output)</code></pre></div>
<pre><code>## Nonlinear regression model
##   model: deriv ~ fs_mixture(temp_C, h1, s1, p1, w1, h2, s2, p2, w2, h3,     s3, p3, w3)
##    data: dataframe
##        h1        s1        p1        w1        h2        s2        p2 
## 3.944e-03 1.258e-01 2.662e+02 5.106e+01 5.793e-03 1.344e-02 3.173e+02 
##        w2        h3        s3        p3        w3 
## 2.866e+01 1.163e-03 1.085e-01 3.300e+02 2.500e+02 
##  residual sum-of-squares: 9.299e-06
## 
## Number of iterations to convergence: 23 
## Achieved convergence tolerance: 1.49e-08</code></pre>
<p>We can see the estimated parameter values (h = height, s = skew, p = position, and w = width) for each curve. Curve 1 is hemicellulose, curve 2 is cellulose, and curve 3 is lignin. If present, the optional fourth curve located at the lowest temperature interval will be listed as curve 0.</p>
</div>
<div id="section-mass-fractions-output" class="section level4">
<h4 class="hasAnchor">
<a href="#section-mass-fractions-output" class="anchor"></a>mass fractions output</h4>
<p><code><a href="../reference/Weights.html">Weights()</a></code> will display the mean proportions as well as estimated upper and lower confidence intervals of each carbon component:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/Weights.html">Weights</a></span>(output)</code></pre></div>
<pre><code>##         HC       CL       LG value_type
## 1 20.43273 16.64336 29.52019       2.5%
## 2 22.75751 18.67005 31.83022      97.5%
## 3 21.56004 17.67487 30.66299       mean</code></pre>
</div>
</div>
<div id="section-plot-deconvolved-curve" class="section level3">
<h3 class="hasAnchor">
<a href="#section-plot-deconvolved-curve" class="anchor"></a>6. Plot deconvolved curve</h3>
<p>Take a look at your plot. Do the estimates seem reasonable? In many cases, the peak of HC occurs at the lowest temperature, followed by CL and finally LG. If your plot doesn’t follow this pattern, can you think of an ecological explanation given your species/plant material type?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(output)</code></pre></div>
<p><img src="deconvolve_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<hr>
<p>This is still a work in progress! If you see any mistakes, or find that the code is not functioning well on your data, let me know by logging a bug on the issues page of the github: <a href="http://www.github.com/smwindecker/deconvolve" class="uri">http://www.github.com/smwindecker/deconvolve</a>. Thanks to the Holsworth Wildlife Reseach Endowment &amp; The Ecological Society of Australia for support on this project.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#section-why-deconvolution">Why deconvolution?</a></li>
      <li><a href="#section-mixture-model">Mixture model</a></li>
      <li><a href="#section-workflow">Workflow</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Saras Windecker, Nick Golding.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
